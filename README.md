# lvjb (lv's Java build system)

`lvjb` is a fast, minimal, Java build + test tool. Designed for self-contained programs and a very specific workflow.

Aligned with `cargo` and `make` in terms of workflow, trying actively to avoid the bloat of developing in java using dependencies, and giving control to the developer instead of being a black box.

## Features

-  **Incremental compilation** using `xxh3` hashing
-  **Multithreaded test runner** (via JNI)
-  **Custom build hooks**, before and after compilation
-  **Configurable classpaths**, `lib/*` expansion, and source/test directories
-  **TOML-based config** with caching baked in
-  **Javadoc generation**
-  **One-line URL fetcher** for remote JARs

## Project Layout

```
root/
├── src/                # Java source files (mandatory)
├── test/               # Java test files
├── bin/                # Compiled class files
├── lib/                # External jars (use `lib/*`)
├── docs/               # Javadoc output
├── releases/           # Output JARs from `release`
├── lvjb.toml            # Main config
├── lvjb.lock            # Build cache (autogenerated)
```

## Commands

| Command | What It Does |
|--------|----------------|
| `lvjb init` | Initializes project structure and config |
| `lvjb initpkg com.example.foo` | Creates folder tree `src/com/example/foo` |
| `lvjb build pkg` | Builds Java sources (incrementally unless `--re` or config-specific) |
| `lvjb build` | Builds Java sources from `default` |
| `lvjb test` | Compiles + runs all test files (via JNI, in parallel) |
| `lvjb run [MainClass]` | Runs specified Java class |
| `lvjb run [MainClass] -- [args]` | Runs specified Java class with args starting at `--` |
| `lvjb clean` | Deletes all `.class` files and clears cache |
| `lvjb docgen MyClass` | Runs `javadoc` on given class |
| `lvjb curl http://...jar` | Downloads and registers a remote JAR |
| `lvjb release` | Creates a .jar with the entry point and name specified in the config|

## Config: `lvjb.toml`

```toml
jar = "out"
compiler = "javac"
entry_point = "com.example.Main"
src_ext = "java"
classpath = ["bin", "lib/*"]
incremental = true
log_level = 0
version = "0.1.0"
pre_build_cmds = ["echo compiling..."]
post_build_cmds = ["echo done!"]

[paths]
src = "src"
src_nopkg = "default"
bin = "bin"
lib = "lib"
test = "test"
docs = "docs"
releases = "releases"

[args]
compilation = ["-Xlint"]
runtime = []
test = []
jvm = []
```

## Test Runner

Test files in `test/` are compiled, then executed as Java programs using JNI. Each file is spun off into its own thread.

## Clean Up

```bash
lvjb clean
```

Removes all `.class` files and resets the build cache.

## Dependencies

As previously mentioned, this tool is inspired by `make`/`cargo`, and no heavy dependencies and traversals are expected, just pure user-managed dependencies.

The `curl` command can be of help for this.

## Native Building

This compiles to the native architecture of your machine, enabling any form of hardware acceleration possible, see `.cargo/config.toml` for more info.

```bash
cargo build --release
```

## Releases

Releases of this software are compiled using `release.sh`, that strips any data from the compiling machine left in the binary, and targets unknown linux x86_64 architectures, compiling with musl statically for maximum compatibility and compressed with upx for smaller binaries
